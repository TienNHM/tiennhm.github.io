---
title: 21. Review 3
slug: 21-review-3
description: Ki·ªÉm tra ki·∫øn th·ª©c - B√†i t·∫≠p t·ªïng h·ª£p cho tu·∫ßn 3
image: https://tiennhm.github.io/img/docs/database.jpg
sidebar_position: 21
# sidebar_class_name: hidden
tags:
    - database
    - sql
    - learn-sql
    - roadmap
    - dbms
keywords: [database, sql, learn-sql, roadmap, dbms]
enableComments: true # for Gisqus comments, set to true
draft: false # set to true to hide this post from the site
---

## üîç **1. T·ªïng k·∫øt ki·∫øn th·ª©c tu·∫ßn 3**  
Tu·∫ßn n√†y, b·∫°n ƒë√£ h·ªçc v·ªÅ c√°c k·ªπ thu·∫≠t SQL n√¢ng cao v√† t·ªëi ∆∞u h√≥a truy v·∫•n, bao g·ªìm:  
‚úÖ **Ch·ªâ m·ª•c (Indexes):** TƒÉng t·ªëc ƒë·ªô truy v·∫•n b·∫±ng c√°ch t·∫°o index ph√π h·ª£p.  
‚úÖ **Transactions & ACID:** ƒê·∫£m b·∫£o t√≠nh nh·∫•t qu√°n c·ªßa d·ªØ li·ªáu khi th·ª±c hi·ªán giao d·ªãch.  
‚úÖ **Stored Procedures & Functions:** Vi·∫øt m√£ SQL t√°i s·ª≠ d·ª•ng, gi√∫p t·ª± ƒë·ªông h√≥a truy v·∫•n.  
‚úÖ **Triggers:** T·ª± ƒë·ªông h√≥a x·ª≠ l√Ω d·ªØ li·ªáu khi c√≥ thay ƒë·ªïi trong b·∫£ng.  
‚úÖ **Views:** T·∫°o b·∫£ng ·∫£o gi√∫p ƒë∆°n gi·∫£n h√≥a c√°c truy v·∫•n ph·ª©c t·∫°p.  
‚úÖ **Ph√¢n t√≠ch hi·ªáu su·∫•t:** S·ª≠ d·ª•ng `EXPLAIN ANALYZE` ƒë·ªÉ ki·ªÉm tra v√† t·ªëi ∆∞u truy v·∫•n.  

---  

## üìù **2. B√†i t·∫≠p th·ª±c h√†nh t·ªïng h·ª£p**  

### **üîπ B√†i 1: T·∫°o Index v√† ki·ªÉm tra hi·ªáu su·∫•t**  
**Y√™u c·∫ßu:**  
- T·∫°o b·∫£ng `orders` v·ªõi d·ªØ li·ªáu l·ªõn (~100.000 d√≤ng).  
- Th√™m ch·ªâ m·ª•c (`INDEX`) v√†o c·ªôt `customer_id` v√† so s√°nh th·ªùi gian truy v·∫•n tr∆∞·ªõc v√† sau khi t·∫°o index.  

**C·∫•u tr√∫c b·∫£ng:**  
```sql
CREATE TABLE orders (
    order_id INT PRIMARY KEY AUTO_INCREMENT,
    customer_id INT,
    order_date DATETIME,
    total_amount DECIMAL(10,2)
);
```
**T·∫°o d·ªØ li·ªáu m·∫´u:**  
```sql
INSERT INTO orders (customer_id, order_date, total_amount)
SELECT FLOOR(RAND() * 1000), NOW() - INTERVAL FLOOR(RAND() * 365) DAY, RAND() * 500
FROM generate_series(1, 100000);
```
**Truy v·∫•n ki·ªÉm tra hi·ªáu su·∫•t:**  
```sql
EXPLAIN ANALYZE 
SELECT * FROM orders WHERE customer_id = 500;
```
**Th√™m Index:**  
```sql
CREATE INDEX idx_customer_id ON orders(customer_id);
```
**Ch·∫°y l·∫°i truy v·∫•n v√† so s√°nh k·∫øt qu·∫£.**  

---  

### **üîπ B√†i 2: Vi·∫øt Transaction x·ª≠ l√Ω ƒë·∫∑t h√†ng**  
**Y√™u c·∫ßu:**  
- ƒê·∫£m b·∫£o r·∫±ng khi ƒë·∫∑t h√†ng, n·∫øu b·∫•t k·ª≥ thao t√°c n√†o th·∫•t b·∫°i, to√†n b·ªô giao d·ªãch ph·∫£i ƒë∆∞·ª£c h·ªßy (`ROLLBACK`).  
- C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng t·ªìn kho trong b·∫£ng `products`.  

**C·∫•u tr√∫c b·∫£ng:**  
```sql
CREATE TABLE products (
    product_id INT PRIMARY KEY AUTO_INCREMENT,
    product_name VARCHAR(255),
    stock_quantity INT
);

CREATE TABLE orders (
    order_id INT PRIMARY KEY AUTO_INCREMENT,
    customer_id INT,
    order_date DATETIME
);

CREATE TABLE order_items (
    order_item_id INT PRIMARY KEY AUTO_INCREMENT,
    order_id INT,
    product_id INT,
    quantity INT,
    FOREIGN KEY (order_id) REFERENCES orders(order_id),
    FOREIGN KEY (product_id) REFERENCES products(product_id)
);
```
**Transaction x·ª≠ l√Ω ƒë·∫∑t h√†ng:**  
```sql
START TRANSACTION;

INSERT INTO orders (customer_id, order_date) VALUES (123, NOW());
SET @order_id = LAST_INSERT_ID();

INSERT INTO order_items (order_id, product_id, quantity) VALUES (@order_id, 5, 2);

UPDATE products SET stock_quantity = stock_quantity - 2 WHERE product_id = 5;

COMMIT;
```
N·∫øu x·∫£y ra l·ªói, c√≥ th·ªÉ d√πng:  
```sql
ROLLBACK;
```

---  

### **üîπ B√†i 3: T·∫°o Stored Procedure b√°o c√°o doanh thu**  
**Y√™u c·∫ßu:**  
- Vi·∫øt Stored Procedure nh·∫≠n tham s·ªë th√°ng/nƒÉm v√† tr·∫£ v·ªÅ t·ªïng doanh thu.  

**Stored Procedure:**  
```sql
DELIMITER //

CREATE PROCEDURE GetMonthlyRevenue(IN p_month INT, IN p_year INT)
BEGIN
    SELECT SUM(total_amount) AS total_revenue
    FROM orders
    WHERE MONTH(order_date) = p_month AND YEAR(order_date) = p_year;
END //

DELIMITER ;
```
**G·ªçi Stored Procedure:**  
```sql
CALL GetMonthlyRevenue(2, 2025);
```

---  

### **üîπ B√†i 4: S·ª≠ d·ª•ng Trigger c·∫≠p nh·∫≠t t·ªìn kho t·ª± ƒë·ªông**  
**Y√™u c·∫ßu:**  
- Khi c√≥ ƒë∆°n h√†ng m·ªõi, t·ª± ƒë·ªông tr·ª´ s·ªë l∆∞·ª£ng h√†ng t·ªìn kho.  

**Trigger:**  
```sql
DELIMITER //

CREATE TRIGGER update_stock_after_order
AFTER INSERT ON order_items
FOR EACH ROW
BEGIN
    UPDATE products 
    SET stock_quantity = stock_quantity - NEW.quantity
    WHERE product_id = NEW.product_id;
END //

DELIMITER ;
```

---  

### **üîπ B√†i 5: T·∫°o View gi√∫p ƒë∆°n gi·∫£n h√≥a truy v·∫•n**  
**Y√™u c·∫ßu:**  
- T·∫°o View `OrderSummary` ƒë·ªÉ truy v·∫•n nhanh ƒë∆°n h√†ng, kh√°ch h√†ng, s·∫£n ph·∫©m.  

**View:**  
```sql
CREATE VIEW OrderSummary AS
SELECT o.order_id, o.customer_id, c.customer_name, oi.product_id, p.product_name, oi.quantity, o.order_date
FROM orders o
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
JOIN customers c ON o.customer_id = c.customer_id;
```
**Truy v·∫•n View:**  
```sql
SELECT * FROM OrderSummary WHERE customer_id = 123;
```

---  

### **üîπ B√†i 6: Ph√¢n t√≠ch hi·ªáu su·∫•t truy v·∫•n**  
**Y√™u c·∫ßu:**  
- Ch·∫°y `EXPLAIN ANALYZE` ƒë·ªÉ ki·ªÉm tra hi·ªáu su·∫•t.  

**Truy v·∫•n ki·ªÉm tra:**  
```sql
EXPLAIN ANALYZE 
SELECT * FROM orders WHERE order_date BETWEEN '2024-01-01' AND '2024-12-31';
```
N·∫øu truy v·∫•n ch·∫≠m, c√≥ th·ªÉ th·ª≠ th√™m index:  
```sql
CREATE INDEX idx_order_date ON orders(order_date);
```
Ch·∫°y l·∫°i truy v·∫•n v√† so s√°nh k·∫øt qu·∫£.  

---

## üî• **T√≥m t·∫Øt b√†i h·ªçc Ng√†y 21**
- Vi·∫øt truy v·∫•n SQL t·ªëi ∆∞u.  
- ƒê√°nh gi√° hi·ªáu su·∫•t tr∆∞·ªõc v√† sau khi t·ªëi ∆∞u.  
- Hi·ªÉu c√°ch s·ª≠ d·ª•ng Index, Transactions, Views, Stored Procedures v√† Triggers.  


üöÄ **Ng√†y mai:** [L√†m vi·ªác v·ªõi d·ªØ li·ªáu JSON trong SQL.](22.%20SQL%20Json%20practice.md)

üìå **L·ªô tr√¨nh:** [H·ªçc SQL trong 30 ng√†y](00.%2030-Day%20SQL%20Learning%20Roadmap.md) üöÄ