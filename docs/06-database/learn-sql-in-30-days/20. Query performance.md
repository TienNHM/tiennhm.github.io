---
title: 20. Query Performance
slug: 20-query-performance
description: TÃ¬m hiá»ƒu cÃ¡ch phÃ¢n tÃ­ch vÃ  tá»‘i Æ°u hiá»‡u suáº¥t truy váº¥n SQL báº±ng EXPLAIN ANALYZE.
image: https://tiennhm.github.io/img/docs/database.jpg
sidebar_position: 20
tags:
    - database
    - sql
    - learn-sql
    - roadmap
    - dbms
keywords: [database, sql, learn-sql, roadmap, dbms]
enableComments: true
draft: false
---

> Má»¥c tiÃªu bÃ i há»c: Hiá»ƒu cÃ¡ch sá»­ dá»¥ng **EXPLAIN ANALYZE** Ä‘á»ƒ kiá»ƒm tra hiá»‡u suáº¥t truy váº¥n vÃ  so sÃ¡nh hiá»‡u suáº¥t khi cÃ³/khÃ´ng cÃ³ index.

---

## ğŸ” **1. Hiá»‡u suáº¥t truy váº¥n lÃ  gÃ¬?**
**Hiá»‡u suáº¥t truy váº¥n** lÃ  má»©c Ä‘á»™ nhanh/cháº­m khi má»™t truy váº¥n SQL Ä‘Æ°á»£c thá»±c thi. Truy váº¥n tá»‘i Æ°u giÃºp giáº£m táº£i cho cÆ¡ sá»Ÿ dá»¯ liá»‡u, cáº£i thiá»‡n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng vÃ  tiáº¿t kiá»‡m tÃ i nguyÃªn há»‡ thá»‘ng.

ğŸ’¡ **Táº¡i sao cáº§n tá»‘i Æ°u hiá»‡u suáº¥t truy váº¥n?**
âœ” Giáº£m thá»i gian thá»±c thi.
âœ” Tá»‘i Æ°u tÃ i nguyÃªn CPU, RAM, I/O Ä‘Ä©a.
âœ” TrÃ¡nh tÃ¬nh tráº¡ng **cháº­m há»‡ thá»‘ng** khi dá»¯ liá»‡u lá»›n.
âœ” Cáº£i thiá»‡n kháº£ nÄƒng má»Ÿ rá»™ng cá»§a á»©ng dá»¥ng.

---

## âš™ï¸ **2. Kiá»ƒm tra hiá»‡u suáº¥t báº±ng EXPLAIN ANALYZE**
SQL cung cáº¥p lá»‡nh **EXPLAIN ANALYZE** Ä‘á»ƒ phÃ¢n tÃ­ch cÃ¡ch truy váº¥n hoáº¡t Ä‘á»™ng vÃ  tÃ¬m Ä‘iá»ƒm cáº§n tá»‘i Æ°u.

### **Cáº¥u trÃºc cÃ¢u lá»‡nh**
```sql
EXPLAIN ANALYZE <query>;
```
ğŸ”¹ **EXPLAIN**: Hiá»ƒn thá»‹ cÃ¡ch SQL láº­p káº¿ hoáº¡ch thá»±c thi truy váº¥n.  
ğŸ”¹ **ANALYZE**: Thá»±c thi truy váº¥n thá»±c táº¿ vÃ  hiá»ƒn thá»‹ thá»i gian thá»±c thi.

### **VÃ­ dá»¥ kiá»ƒm tra hiá»‡u suáº¥t**
Giáº£ sá»­ chÃºng ta cÃ³ báº£ng `orders` chá»©a **1 triá»‡u báº£n ghi**:
```sql
SELECT * FROM orders WHERE customer_id = 1001;
```
Sá»­ dá»¥ng **EXPLAIN ANALYZE**:
```sql
EXPLAIN ANALYZE SELECT * FROM orders WHERE customer_id = 1001;
```
ğŸ“Œ **Káº¿t quáº£ phÃ¢n tÃ­ch:**
```plaintext
Seq Scan on orders (cost=0.00..14537.00 rows=100 width=50)
   Filter: (customer_id = 1001)
Execution Time: 120.35 ms
```
ğŸš¨ **Váº¥n Ä‘á»:** SQL Ä‘ang thá»±c hiá»‡n **Sequential Scan** (quÃ©t toÃ n bá»™ báº£ng), lÃ m cháº­m truy váº¥n!

---

## ğŸš€ **3. Cáº£i thiá»‡n hiá»‡u suáº¥t vá»›i Index**
### **3.1. Táº¡o Index Ä‘á»ƒ tÄƒng tá»‘c truy váº¥n**
ChÃºng ta táº¡o **chá»‰ má»¥c (Index)** cho cá»™t `customer_id`:
```sql
CREATE INDEX idx_customer_id ON orders(customer_id);
```

ğŸ”¹ **Index** giÃºp tÃ¬m kiáº¿m nhanh hÆ¡n thay vÃ¬ quÃ©t toÃ n bá»™ báº£ng.

### **3.2. Kiá»ƒm tra láº¡i hiá»‡u suáº¥t**
Sau khi thÃªm index, cháº¡y láº¡i EXPLAIN ANALYZE:
```sql
EXPLAIN ANALYZE SELECT * FROM orders WHERE customer_id = 1001;
```

ğŸ“Œ **Káº¿t quáº£ má»›i:**
```plaintext
Index Scan using idx_customer_id on orders (cost=0.00..150.00 rows=100 width=50)
   Index Cond: (customer_id = 1001)
Execution Time: 2.35 ms
```
âœ… **Cáº£i thiá»‡n Ä‘Ã¡ng ká»ƒ**: Tá»« **120.35 ms** xuá»‘ng **2.35 ms**! ğŸš€

---

## ğŸ“Š **4. So sÃ¡nh hiá»‡u suáº¥t: CÃ³ Index vs. KhÃ´ng Index**

| Truy váº¥n                                                  | KhÃ´ng cÃ³ Index | CÃ³ Index |
|-----------------------------------------------------------|----------------|----------|
| `SELECT * FROM orders WHERE customer_id = 1001;`          | 120.35 ms      | 2.35 ms  |
| `SELECT COUNT(*) FROM orders WHERE status = 'Completed';` | 95.80 ms       | 1.80 ms  |
| `SELECT * FROM orders ORDER BY created_at DESC;`          | 150.60 ms      | 3.20 ms  |

ğŸ“Œ **Káº¿t luáº­n:** Index giÃºp giáº£m thá»i gian thá»±c thi tá»« hÃ ng trÄƒm ms xuá»‘ng vÃ i ms!

---

## ğŸ¯ **5. BÃ i táº­p thá»±c hÃ nh**

### âœ… **BÃ i 1: Kiá»ƒm tra hiá»‡u suáº¥t trÃªn báº£ng khÃ¡ch hÃ ng**
> DÃ¹ng `EXPLAIN ANALYZE` Ä‘á»ƒ kiá»ƒm tra truy váº¥n:
```sql
SELECT * 
FROM customers 
WHERE email = 'user@example.com';
```
âœ” Táº¡o index náº¿u cáº§n thiáº¿t.

### âœ… **BÃ i 2: Tá»‘i Æ°u hÃ³a truy váº¥n vá»›i ORDER BY**
> Kiá»ƒm tra hiá»‡u suáº¥t khi sáº¯p xáº¿p dá»¯ liá»‡u:
```sql
SELECT * 
FROM products 
ORDER BY price DESC;
```
âœ” Thá»­ táº¡o index cho `price` vÃ  kiá»ƒm tra hiá»‡u suáº¥t.

### âœ… **BÃ i 3: So sÃ¡nh hiá»‡u suáº¥t khi JOIN**
> Kiá»ƒm tra hiá»‡u suáº¥t khi JOIN hai báº£ng:
```sql
SELECT 
    o.id, 
    c.name, 
    o.total 
FROM orders o 
JOIN customers c ON o.customer_id = c.id;
```
âœ” Kiá»ƒm tra **EXPLAIN ANALYZE** vÃ  tá»‘i Æ°u hÃ³a náº¿u cáº§n.

---

## ğŸ”¥ **TÃ³m táº¯t bÃ i há»c NgÃ y 20**
âœ… **EXPLAIN ANALYZE** giÃºp kiá»ƒm tra hiá»‡u suáº¥t truy váº¥n.  
âœ… **Index** giÃºp tÄƒng tá»‘c truy váº¥n Ä‘Ã¡ng ká»ƒ.  
âœ… **So sÃ¡nh hiá»‡u suáº¥t** giá»¯a cÃ³ Index vÃ  khÃ´ng cÃ³ Index.  
âœ… **Thá»±c hÃ nh:** Kiá»ƒm tra vÃ  tá»‘i Æ°u truy váº¥n vá»›i EXPLAIN ANALYZE.  

---

ğŸš€ **Tiáº¿p theo:** [Ã”n táº­p vÃ  bÃ i táº­p tá»•ng há»£p tuáº§n 3](21.%20Review%203.md).

ğŸ“Œ **Lá»™ trÃ¬nh:** [Há»c SQL trong 30 ngÃ y](00.%2030-Day%20SQL%20Learning%20Roadmap.md).

