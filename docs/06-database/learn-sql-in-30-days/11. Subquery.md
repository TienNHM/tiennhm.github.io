---
title: 11. Truy váº¥n con (Subquery)
slug: 11-subquery
description: Giá»›i thiá»‡u vá» truy váº¥n con (Subquery) trong SQL, cÃ¡ch sá»­ dá»¥ng vÃ  vÃ­ dá»¥ minh há»a.
image: https://tiennhm.github.io/img/docs/database.jpg
sidebar_position: 11
# sidebar_class_name: hidden
tags:
    - database
    - sql
    - learn-sql
    - roadmap
    - dbms
keywords: [database, sql, learn-sql, roadmap, dbms]
enableComments: true # for Gisqus comments, set to true
draft: false # set to true to hide this post from the site
---

> Má»¥c tiÃªu bÃ i há»c: Giá»›i thiá»‡u vá» truy váº¥n con (Subquery) trong SQL, cÃ¡ch sá»­ dá»¥ng vÃ  vÃ­ dá»¥ minh há»a.

HÃ´m nay, báº¡n sáº½ há»c vá» **Subquery** (truy váº¥n con) trong SQL, má»™t cÃ´ng cá»¥ máº¡nh máº½ giÃºp **truy váº¥n lá»“ng nhau** vÃ  xá»­ lÃ½ dá»¯ liá»‡u phá»©c táº¡p.  

---

## **1ï¸âƒ£ Subquery lÃ  gÃ¬?**  
**Subquery** lÃ  má»™t truy váº¥n SQL **náº±m bÃªn trong má»™t truy váº¥n khÃ¡c**. NÃ³ cÃ³ thá»ƒ náº±m trong:  
- **SELECT** â†’ DÃ¹ng Ä‘á»ƒ tÃ­nh toÃ¡n dá»¯ liá»‡u bá»• sung.  
- **FROM** â†’ DÃ¹ng nhÆ° má»™t báº£ng táº¡m.  
- **WHERE** â†’ DÃ¹ng Ä‘á»ƒ lá»c dá»¯ liá»‡u dá»±a trÃªn má»™t Ä‘iá»u kiá»‡n.  

ğŸ“Œ **Cáº¥u trÃºc chung cá»§a má»™t Subquery**:  
```sql
SELECT column_name
FROM table_name
WHERE column_name OPERATOR (SELECT column_name FROM another_table);
```
Trong Ä‘Ã³:  
âœ… **Subquery** náº±m trong dáº¥u ngoáº·c `()`.  
âœ… **Operator** cÃ³ thá»ƒ lÃ  `=`, `>`, `<`, `IN`, `NOT IN`, `EXISTS`, v.v.  

---

## **2ï¸âƒ£ Subquery trong WHERE - Lá»c dá»¯ liá»‡u**  
ğŸ“Œ **VÃ­ dá»¥ 1: TÃ¬m sáº£n pháº©m cÃ³ giÃ¡ cao hÆ¡n giÃ¡ trung bÃ¬nh**  
```sql
SELECT ProductName, Price
FROM Products
WHERE Price > (SELECT AVG(Price) FROM Products);
```

âœ… **Giáº£i thÃ­ch:**  
- `SELECT AVG(Price) FROM Products` â†’ TÃ­nh giÃ¡ trung bÃ¬nh cá»§a táº¥t cáº£ sáº£n pháº©m.  
- `WHERE Price > (káº¿t quáº£ trÃªn)` â†’ Lá»c ra cÃ¡c sáº£n pháº©m cÃ³ giÃ¡ cao hÆ¡n trung bÃ¬nh.  

ğŸ“Œ **VÃ­ dá»¥ 2: Láº¥y danh sÃ¡ch khÃ¡ch hÃ ng Ä‘Ã£ tá»«ng Ä‘áº·t hÃ ng**  
```sql
SELECT Name 
FROM Customers
WHERE CustomerID IN (SELECT DISTINCT CustomerID FROM Orders);
```

âœ… **Giáº£i thÃ­ch:**  
- `SELECT DISTINCT CustomerID FROM Orders` â†’ Láº¥y danh sÃ¡ch khÃ¡ch hÃ ng cÃ³ Ä‘Æ¡n hÃ ng.  
- `WHERE CustomerID IN (...)` â†’ Lá»c danh sÃ¡ch khÃ¡ch hÃ ng tá»« báº£ng `Customers`.  

---

## **3ï¸âƒ£ Subquery trong SELECT - TÃ­nh toÃ¡n bá»• sung**  
ğŸ“Œ **VÃ­ dá»¥: Hiá»ƒn thá»‹ tá»•ng sá»‘ Ä‘Æ¡n hÃ ng cá»§a tá»«ng khÃ¡ch hÃ ng**  
```sql
SELECT Name, 
       (SELECT COUNT(*) FROM Orders WHERE Orders.CustomerID = Customers.CustomerID) AS TotalOrders
FROM Customers;
```

âœ… **Giáº£i thÃ­ch:**  
- `COUNT(*)` â†’ Äáº¿m sá»‘ lÆ°á»£ng Ä‘Æ¡n hÃ ng cá»§a tá»«ng khÃ¡ch.  
- `AS TotalOrders` â†’ Hiá»ƒn thá»‹ káº¿t quáº£ nhÆ° má»™t cá»™t bá»• sung.  

---

## **4ï¸âƒ£ Subquery trong FROM - Táº¡o báº£ng táº¡m**  
ğŸ“Œ **VÃ­ dá»¥: TÃ¬m top 3 sáº£n pháº©m cÃ³ giÃ¡ cao nháº¥t**  
```sql
SELECT ProductName, Price
FROM (SELECT ProductName, Price FROM Products ORDER BY Price DESC LIMIT 3) AS TopProducts;
```

âœ… **Giáº£i thÃ­ch:**  
- `ORDER BY Price DESC LIMIT 3` â†’ Láº¥y 3 sáº£n pháº©m Ä‘áº¯t nháº¥t.  
- DÃ¹ng subquery nhÆ° má»™t báº£ng táº¡m.  

---

## **5ï¸âƒ£ Subquery vá»›i EXISTS - Kiá»ƒm tra sá»± tá»“n táº¡i**  
ğŸ“Œ **VÃ­ dá»¥: TÃ¬m khÃ¡ch hÃ ng cÃ³ Ä‘Æ¡n hÃ ng trÃªn 1000$**  
```sql
SELECT Name 
FROM Customers C
WHERE EXISTS (SELECT 1 FROM Orders O WHERE O.CustomerID = C.CustomerID AND O.TotalAmount > 1000);
```

âœ… **Giáº£i thÃ­ch:**  
- `EXISTS` kiá»ƒm tra náº¿u cÃ³ Ä‘Æ¡n hÃ ng **thá»a mÃ£n Ä‘iá»u kiá»‡n** (`TotalAmount > 1000`).  
- Náº¿u cÃ³ Ã­t nháº¥t má»™t Ä‘Æ¡n há»£p lá»‡, khÃ¡ch hÃ ng Ä‘Ã³ Ä‘Æ°á»£c chá»n.  

---

## **6ï¸âƒ£ BÃ i táº­p thá»­ thÃ¡ch ğŸš€**  
ğŸ‘‰ **BÃ i 1:** TÃ¬m sáº£n pháº©m cÃ³ giÃ¡ tháº¥p hÆ¡n giÃ¡ trung bÃ¬nh.  
ğŸ‘‰ **BÃ i 2:** Láº¥y danh sÃ¡ch khÃ¡ch hÃ ng chÆ°a tá»«ng mua hÃ ng.  
ğŸ‘‰ **BÃ i 3:** Hiá»ƒn thá»‹ sá»‘ Ä‘Æ¡n hÃ ng cá»§a má»—i khÃ¡ch hÃ ng nhÆ° má»™t cá»™t (`SELECT`).  
ğŸ‘‰ **BÃ i 4:** Láº¥y danh sÃ¡ch nhÃ¢n viÃªn cÃ³ má»©c lÆ°Æ¡ng cao nháº¥t (`FROM`).  
ğŸ‘‰ **BÃ i 5:** TÃ¬m táº¥t cáº£ khÃ¡ch hÃ ng cÃ³ Ä‘Æ¡n hÃ ng trá»‹ giÃ¡ trÃªn 2000$ (`EXISTS`).  

---

âœ… **TÃ³m táº¯t NgÃ y 11:**  
âœ”ï¸ **Subquery trong WHERE** â†’ Lá»c dá»¯ liá»‡u dá»±a trÃªn má»™t giÃ¡ trá»‹ tÃ­nh toÃ¡n.  
âœ”ï¸ **Subquery trong SELECT** â†’ TÃ­nh toÃ¡n vÃ  hiá»ƒn thá»‹ dá»¯ liá»‡u bá»• sung.  
âœ”ï¸ **Subquery trong FROM** â†’ Sá»­ dá»¥ng truy váº¥n con nhÆ° má»™t báº£ng táº¡m.  
âœ”ï¸ **Subquery vá»›i EXISTS** â†’ Kiá»ƒm tra sá»± tá»“n táº¡i cá»§a dá»¯ liá»‡u.  

ğŸš€ **Tiáº¿p theo:** Há»c vá» [UNION & INTERSECT trong SQL](12.%20UNION%20-%20INTERSECT.md)!

ğŸ“Œ **Lá»™ trÃ¬nh:** [Há»c SQL trong 30 ngÃ y](00.%2030-Day%20SQL%20Learning%20Roadmap.md)