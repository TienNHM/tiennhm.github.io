---
title: 09. GROUP BY - HAVING
slug: 09-group-by-having
description: Giá»›i thiá»‡u vá» GROUP BY vÃ  HAVING trong SQL, cÃ¡ch sá»­ dá»¥ng vÃ  vÃ­ dá»¥ minh há»a.
image: https://tiennhm.github.io/img/docs/database.jpg
sidebar_position: 9
# sidebar_class_name: hidden
tags:
    - database
    - sql
    - learn-sql
    - roadmap
    - dbms
keywords: [database, sql, learn-sql, roadmap, dbms]
enableComments: true # for Gisqus comments, set to true
draft: false # set to true to hide this post from the site
---

# ğŸ”¥ **9: GROUP BY - HAVING**  

> ğŸ“Œ **Má»¥c tiÃªu bÃ i há»c:** Hiá»ƒu cÃ¡ch **nhÃ³m dá»¯ liá»‡u** vá»›i `GROUP BY` vÃ  **lá»c káº¿t quáº£ nhÃ³m** báº±ng `HAVING` trong SQL, giÃºp tá»• chá»©c dá»¯ liá»‡u hiá»‡u quáº£ hÆ¡n trong bÃ¡o cÃ¡o vÃ  phÃ¢n tÃ­ch.  

---

## **1ï¸âƒ£ Chuáº©n bá»‹ dá»¯ liá»‡u**  

Náº¿u chÆ°a cÃ³ database, cháº¡y lá»‡nh nÃ y Ä‘á»ƒ táº¡o láº¡i:  
```sql
CREATE DATABASE ShopDB;
USE ShopDB;

CREATE TABLE Orders (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    CustomerID INT NOT NULL,
    TotalAmount FLOAT NOT NULL,
    OrderDate DATE NOT NULL
);

INSERT INTO Orders (CustomerID, TotalAmount, OrderDate) VALUES
(1, 1500, '2024-02-20'),
(2, 1200, '2024-02-21'),
(3, 500, '2024-02-22'),
(1, 800, '2024-02-22'),
(2, 2000, '2024-02-23'),
(3, 700, '2024-02-23');
```

## **2ï¸âƒ£ GROUP BY**  

### ğŸ”¹ **GROUP BY lÃ  gÃ¬?**  
**`GROUP BY`** trong SQL dÃ¹ng Ä‘á»ƒ **nhÃ³m cÃ¡c hÃ ng cÃ³ cÃ¹ng giÃ¡ trá»‹ trong má»™t hoáº·c nhiá»u cá»™t**, giÃºp thá»±c hiá»‡n cÃ¡c phÃ©p tÃ­nh tá»•ng há»£p trÃªn tá»«ng nhÃ³m dá»¯ liá»‡u.  

ğŸ’¡ **á»¨ng dá»¥ng:**  
- NhÃ³m dá»¯ liá»‡u theo danh má»¥c (vÃ­ dá»¥: doanh thu theo ngÃ y, tá»•ng Ä‘Æ¡n hÃ ng theo khÃ¡ch hÃ ng).  
- Káº¿t há»£p vá»›i **Aggregate Functions** nhÆ° `COUNT()`, `SUM()`, `AVG()`, `MIN()`, `MAX()`.  

ğŸ“Œ **CÃº phÃ¡p:**  
```sql
SELECT column1, AggregateFunction(column2)
FROM table_name
GROUP BY column1;
```
ğŸ”¹ Trong Ä‘Ã³:  
- `column1` lÃ  cá»™t dÃ¹ng Ä‘á»ƒ nhÃ³m.  
- `AggregateFunction(column2)` lÃ  hÃ m tá»•ng há»£p Ã¡p dá»¥ng cho nhÃ³m Ä‘Ã³.  

### ğŸ”¹ **GROUP BY vá»›i nhiá»u cá»™t**  

Báº¡n cÃ³ thá»ƒ nhÃ³m theo nhiá»u cá»™t báº±ng cÃ¡ch liá»‡t kÃª cÃ¡c cá»™t trong `GROUP BY`:  
```sql
SELECT CustomerID, OrderDate, SUM(TotalAmount) AS DailySpent
FROM Orders
GROUP BY CustomerID, OrderDate;
```
âœ… Káº¿t quáº£:  
| CustomerID | OrderDate  | DailySpent |
|------------|------------|------------|
| 1          | 2024-02-20 | 1500       |
| 1          | 2024-02-22 | 800        |
| 2          | 2024-02-21 | 1200       |
| 2          | 2024-02-23 | 2000       |

ğŸ”¹ **LÆ°u Ã½:** Khi dÃ¹ng `GROUP BY` vá»›i nhiá»u cá»™t, dá»¯ liá»‡u sáº½ nhÃ³m theo tá»«ng tá»• há»£p duy nháº¥t cá»§a cÃ¡c cá»™t Ä‘Ã³.  

### ğŸ”¹ **VÃ­ dá»¥ minh há»a**

ğŸ“Œ **Äáº¿m sá»‘ Ä‘Æ¡n hÃ ng cá»§a má»—i khÃ¡ch hÃ ng**  
```sql
SELECT CustomerID, COUNT(*) AS OrderCount
FROM Orders
GROUP BY CustomerID;
```
âœ… Káº¿t quáº£:  
| CustomerID | OrderCount |
|------------|------------|
| 1          | 2          |
| 2          | 2          |
| 3          | 2          |

ğŸ“Œ **TÃ­nh tá»•ng doanh thu theo tá»«ng ngÃ y**  
```sql
SELECT OrderDate, SUM(TotalAmount) AS DailyRevenue
FROM Orders
GROUP BY OrderDate;
```
âœ… Káº¿t quáº£:  
| OrderDate  | DailyRevenue |
|------------|--------------|
| 2024-02-20 | 1500         |
| 2024-02-21 | 1200         |
| 2024-02-22 | 1300         |
| 2024-02-23 | 2700         |

## **3ï¸âƒ£ HAVING**  

### ğŸ”¹ **HAVING lÃ  gÃ¬?**  
`HAVING` dÃ¹ng Ä‘á»ƒ **lá»c dá»¯ liá»‡u sau khi nhÃ³m (`GROUP BY`)**, tÆ°Æ¡ng tá»± nhÆ° `WHERE`, nhÆ°ng **`WHERE` khÃ´ng thá»ƒ dÃ¹ng vá»›i Aggregate Functions**.

ğŸ’¡ **á»¨ng dá»¥ng:**
- Lá»c nhÃ³m dá»¯ liá»‡u theo Ä‘iá»u kiá»‡n cá»¥ thá»ƒ (vÃ­ dá»¥: chá»‰ láº¥y nhÃ³m cÃ³ tá»•ng chi tiÃªu lá»›n hÆ¡n 2000).
- GiÃºp lá»c dá»¯ liá»‡u sau khi nhÃ³m (thÃ´ng thÆ°á»ng dÃ¹ng vá»›i `COUNT()`, `SUM()`, `AVG()`), khi `WHERE` khÃ´ng thá»ƒ dÃ¹ng.

ğŸ“Œ **CÃº phÃ¡p:**  
```sql
SELECT column1, AggregateFunction(column2)
FROM table_name
GROUP BY column1
HAVING AggregateFunction(column2) condition;
```

### ğŸ”¹ **So sÃ¡nh `WHERE` vÃ  `HAVING`**  

| ğŸ” **TÃ­nh nÄƒng**       | âŒ `WHERE` khÃ´ng dÃ¹ng Ä‘Æ°á»£c | âœ… `HAVING` dÃ¹ng Ä‘Æ°á»£c |
|-----------------|-------------------|----------------|
| Lá»c theo giÃ¡ trá»‹ cá»¥ thá»ƒ | âœ… Há»— trá»£  | âœ… Há»— trá»£  |
| Lá»c dá»±a trÃªn Aggregate Functions | âŒ KhÃ´ng há»— trá»£  | âœ… Há»— trá»£  |
| Sá»­ dá»¥ng vá»›i `GROUP BY` | âŒ KhÃ´ng Ä‘Æ°á»£c  | âœ… Há»— trá»£  |

### ğŸ”¹ **VÃ­ dá»¥ minh há»a**

ğŸ“Œ **Chá»‰ láº¥y khÃ¡ch hÃ ng cÃ³ tá»•ng chi tiÃªu > 2000**  
```sql
SELECT CustomerID, SUM(TotalAmount) AS TotalSpent
FROM Orders
GROUP BY CustomerID
HAVING SUM(TotalAmount) > 2000;
```
âœ… Káº¿t quáº£:  
| CustomerID | TotalSpent |
|------------|------------|
| 2          | 3200       |

ğŸ“Œ **Chá»‰ láº¥y cÃ¡c ngÃ y cÃ³ tá»•ng doanh thu >= 2000**  
```sql
SELECT OrderDate, SUM(TotalAmount) AS DailyRevenue
FROM Orders
GROUP BY OrderDate
HAVING SUM(TotalAmount) >= 2000;
```
âœ… Káº¿t quáº£:  
| OrderDate  | DailyRevenue |
|------------|--------------|
| 2024-02-23 | 2700         |

## **4ï¸âƒ£ LÆ°u Ã½ khi sá»­ dá»¥ng káº¿t há»£p GROUP BY, HAVING vÃ  ORDER BY**  

### ğŸ”¹ **CÃ¡c lá»—i thÆ°á»ng gáº·p**
âš ï¸ **1. CÃ¡c cá»™t trong SELECT pháº£i cÃ³ trong GROUP BY hoáº·c lÃ  Aggregate Function**  
VÃ­ dá»¥ sau sáº½ bÃ¡o lá»—i:  
```sql
SELECT CustomerID, OrderDate, SUM(TotalAmount) 
FROM Orders
GROUP BY CustomerID;
```
â›” **LÃ½ do:** `OrderDate` khÃ´ng cÃ³ trong `GROUP BY` vÃ  cÅ©ng khÃ´ng Ä‘Æ°á»£c dÃ¹ng vá»›i Aggregate Function nÃ o.  
âœ… **Sá»­a Ä‘Ãºng:**  
```sql
SELECT CustomerID, SUM(TotalAmount) 
FROM Orders
GROUP BY CustomerID;
```

âš ï¸ **2. Sáº¯p xáº¿p dá»¯ liá»‡u sau khi nhÃ³m vá»›i ORDER BY**  
Máº·c Ä‘á»‹nh, `GROUP BY` **khÃ´ng sáº¯p xáº¿p dá»¯ liá»‡u**, do Ä‘Ã³ cáº§n dÃ¹ng `ORDER BY`:  
```sql
SELECT CustomerID, COUNT(*) AS OrderCount
FROM Orders
GROUP BY CustomerID
ORDER BY OrderCount DESC;
```

âš ï¸ **3. KhÃ´ng thá»ƒ dÃ¹ng WHERE Ä‘á»ƒ lá»c Aggregate Function**  
â›” Sai:  
```sql
SELECT CustomerID, SUM(TotalAmount) 
FROM Orders
WHERE SUM(TotalAmount) > 2000
GROUP BY CustomerID;
```
âœ… ÄÃºng (dÃ¹ng `HAVING` thay vÃ¬ `WHERE`):  
```sql
SELECT CustomerID, SUM(TotalAmount) 
FROM Orders
GROUP BY CustomerID
HAVING SUM(TotalAmount) > 2000;
```

âš ï¸ **4. TrÃ¡nh nhÃ³m dá»¯ liá»‡u quÃ¡ lá»›n**  
Náº¿u báº£ng chá»©a hÃ ng triá»‡u báº£n ghi, viá»‡c `GROUP BY` cÃ³ thá»ƒ gÃ¢y hiá»‡u suáº¥t cháº­m.  
âœ… **Giáº£i phÃ¡p:** Lá»c trÆ°á»›c vá»›i `WHERE` trÆ°á»›c khi `GROUP BY`.  
```sql
SELECT CustomerID, SUM(TotalAmount) 
FROM Orders
WHERE OrderDate >= '2024-02-01' -- Giáº£m sá»‘ lÆ°á»£ng báº£n ghi trÆ°á»›c
GROUP BY CustomerID;
```

### ğŸ”¹ **VÃ­ dá»¥ minh há»a**

ğŸ“Œ **Láº¥y danh sÃ¡ch khÃ¡ch hÃ ng cÃ³ tá»« 2 Ä‘Æ¡n hÃ ng trá»Ÿ lÃªn, sáº¯p xáº¿p theo tá»•ng chi tiÃªu giáº£m dáº§n**  
```sql
SELECT 
    CustomerID, 
    COUNT(*) AS OrderCount, 
    SUM(TotalAmount) AS TotalSpent
FROM Orders
GROUP BY CustomerID
HAVING COUNT(*) >= 2
ORDER BY TotalSpent DESC;
```
âœ… Káº¿t quáº£:  
| CustomerID | OrderCount | TotalSpent |
|------------|------------|------------|
| 2          | 2          | 3200       |
| 1          | 2          | 2300       |
| 3          | 2          | 1200       |

## **5ï¸âƒ£ BÃ i táº­p thá»­ thÃ¡ch ğŸš€**  

HÃ£y thá»­ viáº¿t cÃ¡c cÃ¢u lá»‡nh SQL Ä‘á»ƒ giáº£i cÃ¡c bÃ i táº­p sau:  

ğŸ‘‰ **BÃ i 1:** TÃ­nh sá»‘ lÆ°á»£ng Ä‘Æ¡n hÃ ng theo tá»«ng ngÃ y.  
ğŸ‘‰ **BÃ i 2:** TÃ¬m khÃ¡ch hÃ ng cÃ³ tá»•ng chi tiÃªu lá»›n hÆ¡n `1000`.  
ğŸ‘‰ **BÃ i 3:** Äáº¿m sá»‘ lÆ°á»£ng khÃ¡ch hÃ ng cÃ³ Ã­t nháº¥t `2 Ä‘Æ¡n hÃ ng`.  
ğŸ‘‰ **BÃ i 4:** TÃ­nh doanh thu trung bÃ¬nh má»—i ngÃ y, chá»‰ láº¥y ngÃ y cÃ³ doanh thu lá»›n hÆ¡n `1500`.  
ğŸ‘‰ **BÃ i 5:** Láº¥y danh sÃ¡ch ngÃ y cÃ³ trÃªn `1 Ä‘Æ¡n hÃ ng`, sáº¯p xáº¿p theo sá»‘ lÆ°á»£ng Ä‘Æ¡n hÃ ng giáº£m dáº§n.  

## **6ï¸âƒ£ TÃ i liá»‡u tham kháº£o** ğŸ“š  

1ï¸âƒ£ **Official SQL Documentation:**  
ğŸ”— [MySQL GROUP BY & HAVING](https://dev.mysql.com/doc/refman/8.0/en/group-by-modifiers.html)  
ğŸ”— [PostgreSQL GROUP BY](https://www.postgresql.org/docs/current/queries-table-expressions.html#QUERIES-GROUPING-SETOPS)  
ğŸ”— [SQL Server GROUP BY & HAVING](https://learn.microsoft.com/en-us/sql/t-sql/queries/select-group-by-transact-sql)  

2ï¸âƒ£ **SÃ¡ch & KhÃ³a há»c:**  
ğŸ“˜ *SQL for Data Analysis* - Cathy Tanimura  
ğŸ“˜ *Learning SQL* - Alan Beaulieu  
ğŸ“ *[Mode Analytics SQL Tutorial](https://mode.com/sql-tutorial/)*  

---

#### âœ… **TÃ³m táº¯t bÃ i há»c**  

âœ”ï¸ `GROUP BY` - NhÃ³m dá»¯ liá»‡u theo má»™t hoáº·c nhiá»u cá»™t.  
âœ”ï¸ `HAVING` - Lá»c dá»¯ liá»‡u sau khi nhÃ³m (`WHERE` khÃ´ng dÃ¹ng Ä‘Æ°á»£c vá»›i Aggregate Functions).  
âœ”ï¸ Káº¿t há»£p vá»›i `ORDER BY` Ä‘á»ƒ sáº¯p xáº¿p káº¿t quáº£.  

ğŸš€ **Tiáº¿p theo:** Há»c vá» [`JOIN` Ä‘á»ƒ káº¿t ná»‘i nhiá»u báº£ng dá»¯ liá»‡u](10.%20JOIN.md)!

ğŸ“Œ **Lá»™ trÃ¬nh:** [Há»c SQL trong 30 ngÃ y](00.%2030-Day%20SQL%20Learning%20Roadmap.md)