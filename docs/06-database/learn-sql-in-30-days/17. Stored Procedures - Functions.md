---
title: 17. Stored Procedures & Functions
slug: 17-stored-procedures-functions
description: Gi·ªõi thi·ªáu v·ªÅ Stored Procedures v√† User Defined Functions (UDF) trong SQL.
image: https://tiennhm.github.io/img/docs/database.jpg
sidebar_position: 17
# sidebar_class_name: hidden
tags:
    - database
    - sql
    - learn-sql
    - roadmap
    - dbms
keywords: [database, sql, learn-sql, roadmap, dbms]
enableComments: true # for Gisqus comments, set to true
draft: false # set to true to hide this post from the site
---

> M·ª•c ti√™u b√†i h·ªçc: Hi·ªÉu c√°ch s·ª≠ d·ª•ng **Stored Procedures** v√† **User Defined Functions (UDF)** ƒë·ªÉ t·ª± ƒë·ªông h√≥a truy v·∫•n SQL.

---

## **1Ô∏è‚É£ Stored Procedures l√† g√¨?**
**Stored Procedure (Th·ªß t·ª•c l∆∞u tr·ªØ)** l√† m·ªôt t·∫≠p h·ª£p c√°c c√¢u l·ªánh SQL ƒë∆∞·ª£c l∆∞u trong c∆° s·ªü d·ªØ li·ªáu v√† c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng.

üîπ **∆Øu ƒëi·ªÉm:**
- Gi·∫£m l·∫∑p l·∫°i m√£ SQL.
- TƒÉng hi·ªáu su·∫•t v√¨ ƒë√£ ƒë∆∞·ª£c bi√™n d·ªãch tr∆∞·ªõc.
- B·∫£o m·∫≠t t·ªët h∆°n, h·∫°n ch·∫ø SQL Injection.
- Cho ph√©p th·ª±c hi·ªán nhi·ªÅu truy v·∫•n c√πng l√∫c.

üí° **V√≠ d·ª• th·ª±c t·∫ø:**
- T·∫°o b√°o c√°o doanh thu h√†ng th√°ng.
- X·ª≠ l√Ω ƒë·∫∑t h√†ng trong h·ªá th·ªëng e-commerce.
- C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng t·ª± ƒë·ªông.

---

## **2Ô∏è‚É£ C√°ch t·∫°o Stored Procedure trong SQL**

### **üîπ C√∫ ph√°p c∆° b·∫£n**
```sql
CREATE PROCEDURE Ten_Thu_Tuc
AS
BEGIN
    -- C√¢u l·ªánh SQL
END;
```

### **üîπ V√≠ d·ª•: T·∫°o Stored Procedure tr·∫£ v·ªÅ danh s√°ch kh√°ch h√†ng**
```sql
CREATE PROCEDURE GetCustomers
AS
BEGIN
    SELECT * FROM Customers;
END;
```
üëâ **G·ªçi th·ªß t·ª•c:**
```sql
EXEC GetCustomers;
```

### **üîπ Th·ªß t·ª•c c√≥ tham s·ªë**
```sql
CREATE PROCEDURE GetCustomerById (@CustomerId INT)
AS
BEGIN
    SELECT * FROM Customers WHERE Id = @CustomerId;
END;
```
üëâ **G·ªçi th·ªß t·ª•c v·ªõi tham s·ªë:**
```sql
EXEC GetCustomerById 1;
```

---

## **3Ô∏è‚É£ User Defined Functions (UDF) l√† g√¨?**
**User Defined Functions (H√†m do ng∆∞·ªùi d√πng ƒë·ªãnh nghƒ©a)** l√† c√°c h√†m SQL c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng trong truy v·∫•n.

üîπ **∆Øu ƒëi·ªÉm:**
- D√πng trong `SELECT`, `WHERE`, `GROUP BY`, v.v.
- Gi√∫p truy v·∫•n g·ªçn h∆°n, d·ªÖ ƒë·ªçc h∆°n.
- T·ªëi ∆∞u h√≥a hi·ªáu su·∫•t khi t√°i s·ª≠ d·ª•ng nhi·ªÅu l·∫ßn.

### **üîπ C√∫ ph√°p c∆° b·∫£n**
```sql
CREATE FUNCTION Ten_Ham (@ThamSo Kieu_Du_Lieu)
RETURNS Kieu_Tra_Ve
AS
BEGIN
    RETURN (C√¢u l·ªánh SQL);
END;
```

### **üîπ V√≠ d·ª•: H√†m t√≠nh t·ªïng doanh thu th√°ng**
```sql
CREATE FUNCTION GetMonthlyRevenue(@Year INT, @Month INT)
RETURNS DECIMAL(10,2)
AS
BEGIN
    DECLARE @TotalRevenue DECIMAL(10,2);
    SELECT @TotalRevenue = SUM(Amount)
    FROM Orders
    WHERE YEAR(OrderDate) = @Year AND MONTH(OrderDate) = @Month;
    RETURN @TotalRevenue;
END;
```
üëâ **G·ªçi h√†m trong truy v·∫•n:**
```sql
SELECT dbo.GetMonthlyRevenue(2025, 2) AS TotalRevenue;
```

---

## **4Ô∏è‚É£ B√†i t·∫≠p th·ª±c h√†nh üéØ**

### **‚úÖ B√†i 1: Vi·∫øt Stored Procedure l·∫•y danh s√°ch s·∫£n ph·∫©m theo lo·∫°i**
Vi·∫øt m·ªôt `Stored Procedure` nh·∫≠n tham s·ªë `CategoryId`, tr·∫£ v·ªÅ danh s√°ch s·∫£n ph·∫©m thu·ªôc lo·∫°i ƒë√≥.

üí° **G·ª£i √Ω l·ªùi gi·∫£i:**
```sql
CREATE PROCEDURE GetProductsByCategory (@CategoryId INT)
AS
BEGIN
    SELECT * FROM Products WHERE CategoryId = @CategoryId;
END;
```
üëâ **G·ªçi th·ªß t·ª•c:**
```sql
EXEC GetProductsByCategory 1;
```

---

### **‚úÖ B√†i 2: Vi·∫øt h√†m ki·ªÉm tra s·ªë l∆∞·ª£ng h√†ng t·ªìn kho**
Vi·∫øt m·ªôt `User Defined Function` nh·∫≠n `ProductId`, tr·∫£ v·ªÅ s·ªë l∆∞·ª£ng t·ªìn kho.

üí° **G·ª£i √Ω l·ªùi gi·∫£i:**
```sql
CREATE FUNCTION GetStock(@ProductId INT)
RETURNS INT
AS
BEGIN
    DECLARE @Stock INT;
    SELECT @Stock = Stock FROM Products WHERE Id = @ProductId;
    RETURN @Stock;
END;
```
üëâ **G·ªçi h√†m trong truy v·∫•n:**
```sql
SELECT dbo.GetStock(1) AS StockQuantity;
```

---

### **‚úÖ B√†i 3: Vi·∫øt Stored Procedure c·∫≠p nh·∫≠t gi√° s·∫£n ph·∫©m**
Vi·∫øt m·ªôt `Stored Procedure` nh·∫≠n `ProductId` v√† `NewPrice`, c·∫≠p nh·∫≠t gi√° s·∫£n ph·∫©m.

üí° **G·ª£i √Ω l·ªùi gi·∫£i:**
```sql
CREATE PROCEDURE UpdateProductPrice (@ProductId INT, @NewPrice DECIMAL(10,2))
AS
BEGIN
    UPDATE Products SET Price = @NewPrice WHERE Id = @ProductId;
END;
```
üëâ **G·ªçi th·ªß t·ª•c:**
```sql
EXEC UpdateProductPrice 1, 199.99;
```

---

## **üéØ T√≥m t·∫Øt b√†i h·ªçc Ng√†y 17**
‚úÖ **Stored Procedures** gi√∫p t·ª± ƒë·ªông h√≥a truy v·∫•n SQL v√† tƒÉng hi·ªáu su·∫•t.
‚úÖ **User Defined Functions (UDF)** gi√∫p vi·∫øt truy v·∫•n ng·∫Øn g·ªçn, c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng.
‚úÖ **Th·ª±c h√†nh:** Vi·∫øt `Stored Procedure` v√† `UDF` cho c√°c b√†i to√°n th·ª±c t·∫ø.

---

üöÄ **Ng√†y mai:** [Triggers (T·ª± ƒë·ªông h√≥a trong SQL).](18.%20Triggers.md)

üìå **L·ªô tr√¨nh:** [H·ªçc SQL trong 30 ng√†y](00.%2030-Day%20SQL%20Learning%20Roadmap.md).
